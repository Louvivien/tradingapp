
> tradingapp_api@1.0.0 start
> node server.js

[Config] Loading environment variables from: /Users/vivienrichaud/Documents/tradingapp/server/config/.env
[Config] API Key Configuration:
[Config] - Paper Trading API Key ID: Set
[Config] - Paper Trading Secret Key: Set
[Config] - Live Trading API Key ID: Set
[Config] - Live Trading Secret Key: Set
[MongoDB] Initial readyState before connect | state=0 (disconnected)
[MongoDB] Event: connecting | state=2 (connecting)
[MongoDB] Event: connected | state=1 (connected)
[MongoDB] Connected to MongoDB
[MongoDB] Post-connect | state=1 (connected)
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:02 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666782',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '1c939dea694dd8e7ef5fcb9384540607',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:02 GMT',
    'content-type': 'application/json',
    'content-length': '122',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666782',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '241be6013bddb835d37da80972d7f733',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Using paper trading keys for trading operations
[API Info] Using paper trading keys for trading operations
[API] Initializing Alpaca client with paper trading keys
[API] Using base URL: https://paper-api.alpaca.markets
[API] Using data URL: https://data.alpaca.markets
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/account',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:02 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666782',
    'x-request-id': '65224be308b0a3116a17056f3cc49bc6',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Success] Connected to Alpaca API. Account status: ACTIVE
Server is running on port 3000
[HTTP] Incoming GET request for /api/strategies/portfolios/6900bdcb0f1a48ea4f80a13a
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[Debug] User document found, checking for API keys
[Debug] After user document check:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:19 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666800',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': 'd7472116f7746c743a2f2ba27c75da2f',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:19 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666800',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': 'cee8214866f0818a7cbd630e8c7a7382',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Using paper trading keys for trading operations
[HTTP] Incoming POST request for /api/auth/login
[Auth] Login attempt received { username: 'louvivien' }
[Auth] Querying user document
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[Debug] User document found, checking for API keys
[Debug] After user document check:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:36 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666816',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '1d8cbcfe5331e57a538acabbe695dcba',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:36 GMT',
    'content-type': 'application/json',
    'content-length': '122',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666816',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '7a577382b20e778bd1c5df16a9a7b5c5',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Using paper trading keys for trading operations
[Auth] Login successful {
  username: 'louvivien',
  userId: new ObjectId("6477cf0011fcccfa0365bc87"),
  mongoState: 1
}
[HTTP] Incoming GET request for /api/strategies/portfolios/6477cf0011fcccfa0365bc87
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[Debug] User document found, checking for API keys
[Debug] After user document check:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:44 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666824',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '06e7f1ea04fdc849c591f66a49bdd676',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:44 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666824',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '0d762f211855c616b8137822c74348c8',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Using paper trading keys for trading operations
[API Info] Using paper trading keys for trading operations
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/positions',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:44 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666824',
    'x-request-id': '16b60ecc30f7925ce4af808ee24faa28',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Request] {
  method: 'GET',
  url: 'https://data.alpaca.markets/v2/stocks/TQQQ/trades/latest',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:53:44 GMT',
    'content-type': 'application/json',
    'content-length': '117',
    connection: 'keep-alive',
    'x-feed': 'iex',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666824',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '6699bce86c495f899949b21fcf362959',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[HTTP] Incoming GET request for /api/data/portfolio/6477cf0011fcccfa0365bc87
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[HTTP] Incoming GET request for /api/stock/6477cf0011fcccfa0365bc87
[Stocks] getStockForUser called {
  userId: '6477cf0011fcccfa0365bc87',
  authUser: '6477cf0011fcccfa0365bc87',
  mongoState: 1
}
[Stocks] Fetching user document
[Debug] User document found, checking for API keys
[Debug] After user document check:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[HTTP] Incoming GET request for /api/order/6477cf0011fcccfa0365bc87
[Stocks] User document loaded { userId: new ObjectId("6477cf0011fcccfa0365bc87") }
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[Debug] User document found, checking for API keys
[Debug] After user document check:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[HTTP] Incoming GET request for /api/strategies/portfolios/6477cf0011fcccfa0365bc87
[Debug] User document found, checking for API keys
[Debug] After user document check:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[HTTP] Incoming POST request for /api/auth/validate
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[Debug] User document found, checking for API keys
[Debug] After user document check:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '122',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '5d8188c51fe9c273b41e089d6fd8d1db',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '198',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': 'c4be9c24a245e65194797df2a71aa99a',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '122',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '46731167c15aac87a9a31c9e0e15e297',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Forcing paper trading mode
[API Info] Forcing paper trading mode
Using paper trading API: https://paper-api.alpaca.markets
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/positions',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/account',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '198',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '78c342994ad903ceac95501575a7afbc',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '197',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '28c4d89994397b75957e884b6e4cd161',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Forcing live trading mode
[API Info] Forcing live trading mode
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/account/portfolio/history?period=12M',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '122',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '197',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': 'fdfc45049074b67f1977cb4ee590ad54',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Forcing paper trading mode
[API Info] Forcing paper trading mode
Using paper trading API: https://paper-api.alpaca.markets
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/orders',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '196',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '83a1d98fd3f292e2f17b2c89dd84dce1',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '122',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '196',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': '0d7f6fc941f272e05115e71f33aa62b8',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Using paper trading keys for trading operations
[API Info] Using paper trading keys for trading operations
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/positions',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[HTTP] Incoming GET request for /api/auth/user
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666928',
    'x-request-id': 'bd14e86a6521bdf6366a049b974f61b2',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '198',
    'x-ratelimit-reset': '1761666928',
    'x-request-id': '06e57b4a6d10bfecfebca1e180e5bc03',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[HTTP] Incoming GET request for /api/stock/6477cf0011fcccfa0365bc87
[Stocks] getStockForUser called {
  userId: '6477cf0011fcccfa0365bc87',
  authUser: '6477cf0011fcccfa0365bc87',
  mongoState: 1
}
[Stocks] Fetching user document
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'content-length': '2',
    connection: 'keep-alive',
    'access-control-allow-origin': '*',
    vary: 'Origin',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '197',
    'x-ratelimit-reset': '1761666928',
    'x-request-id': '3fddb0a435309ee875583357e2d48261',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/positions',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[Stocks] User document loaded { userId: new ObjectId("6477cf0011fcccfa0365bc87") }
[Debug] Environment variables loaded:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[Debug] - Live Key ID: AKILU...
[Debug] - Live Secret: 6v68e...
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-portfolio-history-engine-version': 'v2',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666928',
    'x-request-id': 'f89e9fa41981dd194ac09eb9c6147ed5',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '196',
    'x-ratelimit-reset': '1761666929',
    'x-request-id': '49b78b63c081f2b710d0db9178dd90ca',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Request] {
  method: 'GET',
  url: 'https://data.alpaca.markets/v2/stocks/TQQQ/trades/latest',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[Debug] User document found, checking for API keys
[Debug] After user document check:
[Debug] - Paper Key ID: PK5SX...
[Debug] - Paper Secret: OeC06...
[API Info] Paper trading keys are present
[API Info] Live trading key format is valid (starts with AK)
[API Info] Validating Paper trading keys at https://paper-api.alpaca.markets/v2/clock
[API Debug] Using key ID: PK5SX...
[API Info] Validating Live trading keys at https://api.alpaca.markets/v2/clock
[API Debug] Using key ID: AKILU...
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://api.alpaca.markets/v2/clock',
  headers: { 'APCA-API-KEY-ID': 'AKILU...', 'APCA-API-SECRET-KEY': '6v68e...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '195',
    'x-ratelimit-reset': '1761666929',
    'x-request-id': 'a6dbce871470dc6e380a889040ecb235',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/account',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '124',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '195',
    'x-ratelimit-reset': '1761666929',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': 'ba2c9a8932d53009ab384ac63b0b467a',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Live trading keys validated successfully
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json',
    'content-length': '123',
    connection: 'keep-alive',
    vary: 'Accept-Encoding',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '195',
    'x-ratelimit-reset': '1761666929',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': 'cb7c8abc01ade9dfbfc36381ceb03185',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
[API Success] Paper trading keys validated successfully
[API Info] Final configuration:
[API Info] - Paper trading keys valid: true
[API Info] - Live trading keys valid: true
[API Info] - Trading API URL: https://paper-api.alpaca.markets
[API Info] - Data API URL: https://data.alpaca.markets
[API Info] Forcing paper trading mode
[API Info] Forcing paper trading mode
Using paper trading API: https://paper-api.alpaca.markets
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/positions',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Request] {
  method: 'GET',
  url: 'https://paper-api.alpaca.markets/v2/account',
  headers: { 'APCA-API-KEY-ID': 'PK5SX...', 'APCA-API-SECRET-KEY': 'OeC06...' }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '194',
    'x-ratelimit-reset': '1761666929',
    'x-request-id': '120dc3050b34a0d7c00c1caecac70309',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '193',
    'x-ratelimit-reset': '1761666930',
    'x-request-id': 'e0ed7bee1657c086322e5ce3059e3040',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:27 GMT',
    'content-type': 'application/json; charset=UTF-8',
    'transfer-encoding': 'chunked',
    connection: 'keep-alive',
    vary: 'Accept-Encoding, Origin',
    'access-control-allow-origin': '*',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '192',
    'x-ratelimit-reset': '1761666930',
    'x-request-id': '763719a1c1df93bebb708e9c833ed2e4',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS, PUT, DELETE, POST, PATCH',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization, Content-Type, X-Correspondent',
    'access-control-max-age': '1728000'
  }
}
[API Response] {
  status: 200,
  statusText: 'OK',
  headers: Object [AxiosHeaders] {
    date: 'Tue, 28 Oct 2025 15:55:28 GMT',
    'content-type': 'application/json',
    'content-length': '115',
    connection: 'keep-alive',
    'x-feed': 'iex',
    'x-ratelimit-limit': '200',
    'x-ratelimit-remaining': '199',
    'x-ratelimit-reset': '1761666928',
    'strict-transport-security': 'max-age=31536000; includeSubDomains',
    'x-request-id': 'd9b269984f47f974e02c2cb1aa546aa5',
    'access-control-allow-origin': '*',
    'access-control-allow-credentials': 'true',
    'access-control-allow-methods': 'GET, OPTIONS',
    'access-control-allow-headers': 'Apca-Api-Key-Id, Apca-Api-Secret-Key, Authorization',
    'access-control-max-age': '1728000'
  }
}
